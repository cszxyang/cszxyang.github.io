<!doctype html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>DES 加密算法实现 | cszxyang</title>
    <meta property="og:title" content="DES 加密算法实现 - cszxyang">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2018-10-09T22:54:24&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2018-10-09T22:54:24&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="DES 加密算法实现">
        
    <meta name="author" content="">
    <meta property="og:url" content="http://cszxyang.cn/post/2018-10-09-impl-of-des/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="http://cszxyang.cn/">
                        cszxyang
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="http://cszxyang.cn/">首页</a>
                    
                    <a  href="http://cszxyang.cn/categories/" title="分类">分类</a>
                    
                    <a  href="http://cszxyang.cn/tags/" title="标签">标签</a>
                    
                    <a  href="http://cszxyang.cn/archives/" title="归档">归档</a>
                    
                    <a  href="http://cszxyang.cn/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                
                <div class="col-10" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">DES 加密算法实现</h1>
        </header>
        <date class="post-meta meta-date">
            2018年10月9日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='/categories/%E6%8A%80%E6%9C%AF'>技术</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <p>最近在学校学习密码学相关的课程，其中讲到了一些加密算法，教大家这些算法的工作原理，我觉得比较有意思，就抽空的时候尝试自己去写代码实现一下，以此记录。</p>
<h2 id="一-des概述">一. DES概述</h2>
<p>数据加密标准（Data Encryption Standard），一种使用密钥加密的块算法，1977年被美国联邦政府的国家标准局确定为联邦资料处理标准（FIPS），并授权在非密级政府通信中使用，随后该算法在国际上广泛流传开来。需要注意的是，在某些文献中，作为算法的DES称为数据加密算法（Data Encryption Algorithm,DEA），已与作为标准的DES区分开来。</p>
<h3 id="1-几个重要的历史时间">1. 几个重要的历史时间</h3>
<ul>
<li>1973年美国国家标准局（NBS）向社会公开征集加 密算法，以制定加密算法标准；</li>
<li>1974年第二次征集；</li>
<li>1975年选中IBM的算法，并公布征求意见；</li>
<li>1977年1月15日正式颁布；</li>
<li>1998年底以后停用；</li>
<li>1999年颁布3DES为新标准。</li>
</ul>
<h3 id="2-标准加密算法的目标">2. 标准加密算法的目标</h3>
<ul>
<li>用于加密保护政府机构和商业部门的非机密的敏感 数据。</li>
<li>用于加密保护静态存储和传输信道中的数据。</li>
<li>安全使用10 ~ 15年。</li>
</ul>
<h3 id="3密码的整体特点">3.密码的整体特点</h3>
<ul>
<li>分组密码，明文、密文和密钥的分组长度都是64位。</li>
<li>面向二进制的密码算法，因而能够加解密任何形式的计算机数据。</li>
<li>对合运算:
<ul>
<li>f = f<!-- raw HTML omitted -->–1<!-- raw HTML omitted --></li>
<li>加密和解密共用同一算法，使工程实现的工作量减半。</li>
</ul>
</li>
<li>综合运用了置换、代替、代数等基本密码技术。</li>
<li>基本结构属于Feistel结构。</li>
</ul>
<h3 id="4-应用">4. 应用</h3>
<ul>
<li>在全世界范围得到广泛应用。</li>
<li>许多国际组织采用为标准。</li>
<li>产品形式：软件（嵌入式，应用软件） 硬件（芯片，插卡）</li>
</ul>
<h3 id="5-结论">5. 结论</h3>
<ul>
<li>用于其设计目标是安全的。</li>
<li>设计精巧、实现容易、使用方便，堪称典范。</li>
<li>为国际信息安全发挥了重要作用。</li>
</ul>
<h2 id="二-加密过程">二. 加密过程</h2>
<ul>
<li>64位密钥经子密钥产生算法产生出16个子密钥： K<!-- raw HTML omitted -->1<!-- raw HTML omitted -->, K<!-- raw HTML omitted -->2<!-- raw HTML omitted -->, &hellip;, K<!-- raw HTML omitted -->16<!-- raw HTML omitted --> ， 分别供第一次, 第二次, &hellip;, 第十六次加密迭代使用。</li>
<li>64位明文经初始置换IP， 将数据打乱重排并分成左右两半。左边32位构成L<!-- raw HTML omitted -->0<!-- raw HTML omitted --> ， 右边2位构成R<!-- raw HTML omitted -->0 <!-- raw HTML omitted -->。</li>
<li>第一次加密迭代：由加密函数f实现子密钥k<!-- raw HTML omitted -->1<!-- raw HTML omitted -->对R<!-- raw HTML omitted -->0<!-- raw HTML omitted -->的加密，得到32位的f(R<!-- raw HTML omitted -->0<!-- raw HTML omitted -->, K<!-- raw HTML omitted -->1<!-- raw HTML omitted -->)，然后L<!-- raw HTML omitted -->0<!-- raw HTML omitted -->⊕f(R<!-- raw HTML omitted -->0<!-- raw HTML omitted -->, K<!-- raw HTML omitted -->1<!-- raw HTML omitted -->)，32位的结果作为第二次加密迭代的R<!-- raw HTML omitted -->1<!-- raw HTML omitted -->，以R<!-- raw HTML omitted -->0<!-- raw HTML omitted -->作为第二次加密迭代的L<!-- raw HTML omitted -->1<!-- raw HTML omitted -->。</li>
<li>第二次加密迭代至第十六次加密迭代分别用子密钥K<!-- raw HTML omitted -->2<!-- raw HTML omitted --> ,&hellip;, K<!-- raw HTML omitted -->16<!-- raw HTML omitted -->进行，其过程与第一次加密迭代相同。</li>
<li>第十六次加密迭代结束后，产生一个64位的数据组，以其左边32位作为R<!-- raw HTML omitted -->16<!-- raw HTML omitted -->， 以其右边32位作为L<!-- raw HTML omitted -->16<!-- raw HTML omitted --> 。</li>
<li>R<!-- raw HTML omitted -->16<!-- raw HTML omitted -->与L<!-- raw HTML omitted -->16<!-- raw HTML omitted -->合并，再经过逆初始置换IP， 将数据重新排列，便得到64位密文。</li>
</ul>
<p>
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/desMain.png">
            <img class="mx-auto" alt="img" src="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/desMain.png" />
        </a>
    </p>
<h3 id="1-子密钥的产生">1. 子密钥的产生</h3>
<p>64位密钥经过置换选择1、循环左移、置换选择2等变换，产生16个子密钥 K<!-- raw HTML omitted -->1<!-- raw HTML omitted -->，K<!-- raw HTML omitted -->2<!-- raw HTML omitted -->。&hellip; K<!-- raw HTML omitted -->16<!-- raw HTML omitted -->，分别供各次加密迭代使用。</p>
<p>
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/subkeysgeneration.gif">
            <img class="mx-auto" alt="img" src="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/subkeysgeneration.gif" />
        </a>
    </p>
<h4 id="-1--置换选择1--permuted-choice-1">( 1 ). 置换选择1  (Permuted Choice 1)</h4>
<p>64位的密钥分为8字节，每个字节的第八位是奇偶校验位，前七位才是真正的密钥位。奇偶校验位用于密钥检错，确保其完整性；它不是随机的，可由前七位密钥位算得。因此，DES真正的密钥只有56位。</p>
<p>置换选择1的作用：</p>
<ul>
<li>去掉密钥中的8个奇偶校验位。</li>
<li>把其余的56位打乱重排，将前28位作为C<!-- raw HTML omitted -->0<!-- raw HTML omitted -->， 后28位作为D<!-- raw HTML omitted -->0<!-- raw HTML omitted -->。</li>
</ul>
<p>置换规则：C<!-- raw HTML omitted -->0<!-- raw HTML omitted -->的各位依次为原密钥的第57, 49, &hellip;, 1, &hellip;, 44, 36位；D<!-- raw HTML omitted -->0<!-- raw HTML omitted -->的各位依次为原密钥的第63, 55, &hellip;, 7, &hellip;, 12, 4位。</p>
<p>
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/replaceselect1.png">
            <img class="mx-auto" alt="img" src="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/replaceselect1.png" />
        </a>
    </p>
<h4 id="-2--循环左移-left-shift">( 2 ). 循环左移 （Left Shift）</h4>
<p>对C<!-- raw HTML omitted -->i<!-- raw HTML omitted --> ， D<!-- raw HTML omitted -->i<!-- raw HTML omitted -->分别循环左移n位，其中n是会随着迭代次数变化的，其与迭代次数映射表如下所示</p>
<p>
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/is.png">
            <img class="mx-auto" alt="img" src="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/is.png" />
        </a>
    </p>
<h4 id="-3--置换选择2-permuted-choice-2">( 3 ). 置换选择2 （Permuted Choice 2）</h4>
<p>64位的密钥分成32位的两份，进过置换选择后各成为28位的数据（即C<!-- raw HTML omitted -->0<!-- raw HTML omitted -->和D<!-- raw HTML omitted -->0<!-- raw HTML omitted -->），就是说C<!-- raw HTML omitted -->i<!-- raw HTML omitted -->和D<!-- raw HTML omitted -->i<!-- raw HTML omitted -->都是28位的数据。将C<!-- raw HTML omitted -->i<!-- raw HTML omitted -->和D<!-- raw HTML omitted -->i<!-- raw HTML omitted -->合并成一个56位的数据，置换选择2从中选出一个48位的子密钥K<!-- raw HTML omitted -->i<!-- raw HTML omitted -->。规定子密钥Ki的56位依次是该56位中间数据的第14, 17, &hellip;, 5, 3, &hellip;, 29, 32位，其置换表如下所示</p>
<p>
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/R23.png">
            <img class="mx-auto" alt="img" src="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/R23.png" />
        </a>
    </p>
<h4 id="-4--代码实现">( 4 ). 代码实现</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic"> * 生成16个48位的子密钥
</span><span style="color:#998;font-style:italic"> * @param keyBytes 64位原密钥，用字符数组存储其比特串
</span><span style="color:#998;font-style:italic"> * @return 子密钥数组，用二维字符数组表示
</span><span style="color:#998;font-style:italic"> */</span>
<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[][]</span> <span style="color:#900;font-weight:bold">generateSubKeys</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> keyBytes<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[][]</span> subKeys <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[</span>16<span style="color:#000;font-weight:bold">][</span>48<span style="color:#000;font-weight:bold">];</span>
    <span style="color:#998;font-style:italic">// 置换选择 1
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> c <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">disruptArray</span><span style="color:#000;font-weight:bold">(</span>keyBytes<span style="color:#000;font-weight:bold">,</span> DESConstants<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">replace1C</span><span style="color:#000;font-weight:bold">);</span>
    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> d <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">disruptArray</span><span style="color:#000;font-weight:bold">(</span>keyBytes<span style="color:#000;font-weight:bold">,</span> DESConstants<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">replace1D</span><span style="color:#000;font-weight:bold">);</span>

    <span style="color:#998;font-style:italic">// 循环左移
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> 16<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
        c <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">leftShift</span><span style="color:#000;font-weight:bold">(</span>c<span style="color:#000;font-weight:bold">,</span> DESConstants<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">moveBit</span><span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">]);</span>
        d <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">leftShift</span><span style="color:#000;font-weight:bold">(</span>d<span style="color:#000;font-weight:bold">,</span> DESConstants<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">moveBit</span><span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">]);</span>
        
        <span style="color:#998;font-style:italic">// 将Ci和Di合并得到56位的中间数据
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> concatChars <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">concat</span><span style="color:#000;font-weight:bold">(</span>c<span style="color:#000;font-weight:bold">,</span> d<span style="color:#000;font-weight:bold">);</span>

        <span style="color:#998;font-style:italic">// 置换选择 2，得到48位的子密钥Ki
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> key <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">disruptArray</span><span style="color:#000;font-weight:bold">(</span>concatChars<span style="color:#000;font-weight:bold">,</span> DESConstants<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">replace2</span><span style="color:#000;font-weight:bold">);</span>
        subKeys<span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">=</span> key<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">return</span> subKeys<span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="2-初始置换ip-initial-permutation">2. 初始置换IP (Initial Permutation)</h3>
<p>初始置换是DES算法的第一步密码变换，它的作用是将64位的明文打乱重排，并分成左右两半。左边32位作为L<!-- raw HTML omitted -->0<!-- raw HTML omitted -->，右边32位作为R<!-- raw HTML omitted -->0<!-- raw HTML omitted -->，供后面迭代使用。规定置换后的64位数据的各位依次是原明文数据的第58, 50, &hellip;, 2, 60, &hellip;, 15, 7位，其置换表如下所示</p>
<p>
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/ip.png">
            <img class="mx-auto" alt="img" src="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/ip.png" />
        </a>
    </p>
<h3 id="3-加密函数">3. 加密函数</h3>
<p>加密函数是DES的核心，它的租用是在第i次迭代中用子密钥K<!-- raw HTML omitted -->i<!-- raw HTML omitted -->对R<!-- raw HTML omitted -->i-1<!-- raw HTML omitted -->进行加密。其运行规则是：在第i次迭代加密中选择运算E对32位的R<!-- raw HTML omitted -->i-1<!-- raw HTML omitted -->的各位进行选择排列，产生48位的结果，此结果与48位的子密钥进行异或运算，然后送入替代函数组S。S由8个替代函数（替代盒，Substitute Box）组成，每个S盒有6位输入和4位输出。8个S盒的输出合并得到一个32位的数组，此数据组经过置换运算P，将各位打乱重排，得到的结果便是加密函数的返回值f(R<!-- raw HTML omitted -->i-1<!-- raw HTML omitted -->, K<!-- raw HTML omitted -->i<!-- raw HTML omitted -->)。</p>
<p>
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/sbox.png">
            <img class="mx-auto" alt="img" src="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/sbox.png" />
        </a>
    </p>
<h4 id="1-选择运算-e">1. 选择运算 E</h4>
<p>该过程对32位的数据组Half Block的各位进行选择和排列，产生一个48位的结果，可见该运算是一个扩展运算，它将32位的数据扩展成了48位的数据，以便与48位的子密钥进行异或运算，下面是选择运算的运算矩阵，可见它是通过重复选择某些数据位来达到数据扩展的目的的。</p>
<p>
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/e.png">
            <img class="mx-auto" alt="img" src="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/e.png" />
        </a>
    </p>
<h4 id="2-替代函数组-s">2. 替代函数组 S</h4>
<p>由8个S盒（S<!-- raw HTML omitted -->1<!-- raw HTML omitted -->, S<!-- raw HTML omitted -->2<!-- raw HTML omitted -->, S<!-- raw HTML omitted -->3<!-- raw HTML omitted -->, S<!-- raw HTML omitted -->4<!-- raw HTML omitted -->, S<!-- raw HTML omitted -->5,<!-- raw HTML omitted --> S<!-- raw HTML omitted -->6<!-- raw HTML omitted -->, S<!-- raw HTML omitted -->7<!-- raw HTML omitted -->, S<!-- raw HTML omitted -->8<!-- raw HTML omitted -->）组成，S的输入是一个48位的数据，从1到48位依次加到8个S盒的输入端。每个S盒有一个替代矩阵，规定了其输入输出的替代规则。替代矩阵有4行16列，每行都是0到15这16个数字，但每行数字的排列都不同，且8个替代矩阵彼此不同。每个S盒有6位输入，4位输出，S盒的运算结果是用输出数据替代输入数据，故称为替代函数。</p>
<p>S盒的替代规则为：6位输入的第1位和第6位组成二进制数b<!-- raw HTML omitted -->1<!-- raw HTML omitted -->b<!-- raw HTML omitted -->6<!-- raw HTML omitted -->代表对应矩阵中被选中的行号，其余四位数字b<!-- raw HTML omitted -->2<!-- raw HTML omitted -->b<!-- raw HTML omitted -->3<!-- raw HTML omitted -->b<!-- raw HTML omitted -->4<!-- raw HTML omitted -->b<!-- raw HTML omitted -->5<!-- raw HTML omitted -->组成的二进制数代表对应矩阵中被选中的列号。以S<!-- raw HTML omitted -->1<!-- raw HTML omitted -->为例，假设输入数据为b<!-- raw HTML omitted -->1<!-- raw HTML omitted -->b<!-- raw HTML omitted -->2<!-- raw HTML omitted -->b<!-- raw HTML omitted -->3<!-- raw HTML omitted -->b<!-- raw HTML omitted -->4<!-- raw HTML omitted -->b<!-- raw HTML omitted -->5<!-- raw HTML omitted -->b<!-- raw HTML omitted -->6<!-- raw HTML omitted --> = 101011，则第1位和第6位组成二进制数b<!-- raw HTML omitted -->1<!-- raw HTML omitted -->b<!-- raw HTML omitted -->6<!-- raw HTML omitted --> = 11 = 3，表示选中行号为3的那行；b<!-- raw HTML omitted -->2<!-- raw HTML omitted -->b<!-- raw HTML omitted -->3<!-- raw HTML omitted -->b<!-- raw HTML omitted -->4<!-- raw HTML omitted -->b<!-- raw HTML omitted -->5<!-- raw HTML omitted --> = 0101 = 5，表示选中列号为5的那列，行列交点为9，则S<!-- raw HTML omitted -->1<!-- raw HTML omitted -->的输出为1001。替代函数组 S中各S盒矩阵如下所示</p>
<p>
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/sb.png">
            <img class="mx-auto" alt="img" src="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/sb.png" />
        </a>
    </p>
<h4 id="3-置换运算-p">3. 置换运算 P</h4>
<p>该过程是把S盒输出的32位数据打乱重排，得到32位的加密函数输出，用P置换来扩散，将S盒的混淆租用扩散开来，正是置换P与S盒的互相配合提高了DES的安全性，置换矩阵P如下所示</p>
<p>
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/p.png">
            <img class="mx-auto" alt="img" src="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/p.png" />
        </a>
    </p>
<h4 id="4-代码实现">4. 代码实现</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic"> * DES核心加密函数
</span><span style="color:#998;font-style:italic"> * 包括扩展、替代、选择等操作
</span><span style="color:#998;font-style:italic"> * @param right R(i-1)
</span><span style="color:#998;font-style:italic"> * @param subKey Ki
</span><span style="color:#998;font-style:italic"> * @return result 运算结果
</span><span style="color:#998;font-style:italic"> */</span>
<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> <span style="color:#900;font-weight:bold">coreEncrypt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> right<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> subKey<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#998;font-style:italic">// 1. 选择运算 E
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> extendedRight <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">disruptArray</span><span style="color:#000;font-weight:bold">(</span>right<span style="color:#000;font-weight:bold">,</span> DESConstants<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">E</span><span style="color:#000;font-weight:bold">);</span>
	
    <span style="color:#998;font-style:italic">// 2. 将晋国选择运算E扩展得到的48位的数据与子密钥进行异或
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> xorResult <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">xor</span><span style="color:#000;font-weight:bold">(</span>extendedRight<span style="color:#000;font-weight:bold">,</span> subKey<span style="color:#000;font-weight:bold">);</span>

    <span style="color:#998;font-style:italic">// 3. 用替代函数组进行替代
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// 为便于处理，将上述1x48位的数据矩阵转换成8x6的数据矩阵
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[][]</span> twoDimensionArray <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">segmentDimension</span><span style="color:#000;font-weight:bold">(</span>xorResult<span style="color:#000;font-weight:bold">,</span> 8<span style="color:#000;font-weight:bold">,</span> 6<span style="color:#000;font-weight:bold">);</span>
    StringBuilder outputBuilder <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> StringBuilder<span style="color:#000;font-weight:bold">();</span>
    <span style="color:#998;font-style:italic">// 根据替代规则进行替代
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> twoDimensionArray<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span><span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> rowBits <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>twoDimensionArray<span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">][</span>0<span style="color:#000;font-weight:bold">],</span> twoDimensionArray<span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">][</span>5<span style="color:#000;font-weight:bold">]};</span>
        <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> columnBits <span style="color:#000;font-weight:bold">=</span>
        <span style="color:#000;font-weight:bold">{</span>
            twoDimensionArray<span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">][</span>1<span style="color:#000;font-weight:bold">],</span> twoDimensionArray<span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">][</span>2<span style="color:#000;font-weight:bold">],</span>
            twoDimensionArray<span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">][</span>3<span style="color:#000;font-weight:bold">],</span> twoDimensionArray<span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">][</span>4<span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000;font-weight:bold">};</span>

        <span style="color:#998;font-style:italic">// 获取对应S盒的输出的坐标
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#458;font-weight:bold">int</span> rowIndex <span style="color:#000;font-weight:bold">=</span> Integer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parseInt</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">valueOf</span><span style="color:#000;font-weight:bold">(</span>rowBits<span style="color:#000;font-weight:bold">),</span> 2<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#458;font-weight:bold">int</span> columnIndex <span style="color:#000;font-weight:bold">=</span> Integer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parseInt</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">valueOf</span><span style="color:#000;font-weight:bold">(</span>columnBits<span style="color:#000;font-weight:bold">),</span> 2<span style="color:#000;font-weight:bold">);</span>
		<span style="color:#998;font-style:italic">// 获取对应S盒的输出
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#458;font-weight:bold">short</span> output <span style="color:#000;font-weight:bold">=</span> DESConstants<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">SUBSTITUTE_BOX</span><span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">][</span>rowIndex<span style="color:#000;font-weight:bold">][</span>columnIndex<span style="color:#000;font-weight:bold">];</span>
        outputBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">append</span><span style="color:#000;font-weight:bold">(</span>Integer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toBinaryString</span><span style="color:#000;font-weight:bold">((</span>output <span style="color:#000;font-weight:bold">&amp;</span> 0x0f<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">+</span> 0x10<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">substring</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">));</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> substitutedResult <span style="color:#000;font-weight:bold">=</span> outputBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">toCharArray</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#998;font-style:italic">// 4. 进行置换运算 P，返回28位的数据
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">return</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">disruptArray</span><span style="color:#000;font-weight:bold">(</span>substitutedResult<span style="color:#000;font-weight:bold">,</span> DESConstants<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">P</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="4-整个加密过程">4. 整个加密过程</h3>
<p>回顾DES的总体加密过程</p>
<ul>
<li>64位密钥经子密钥产生算法产生出16个子密钥： K<!-- raw HTML omitted -->1<!-- raw HTML omitted -->, K<!-- raw HTML omitted -->2<!-- raw HTML omitted -->, &hellip;, K<!-- raw HTML omitted -->16<!-- raw HTML omitted --> ， 分别供第一次, 第二次, &hellip;, 第十六次加密迭代使用。</li>
<li>64位明文经初始置换IP， 将数据打乱重排并分成左右两半。左边32位构成L<!-- raw HTML omitted -->0<!-- raw HTML omitted --> ， 右边2位构成R<!-- raw HTML omitted -->0 <!-- raw HTML omitted -->。</li>
<li>第一次加密迭代：由加密函数f实现子密钥k<!-- raw HTML omitted -->1<!-- raw HTML omitted -->对R<!-- raw HTML omitted -->0<!-- raw HTML omitted -->的加密，得到32位的f(R<!-- raw HTML omitted -->0<!-- raw HTML omitted -->, K<!-- raw HTML omitted -->1<!-- raw HTML omitted -->)，然后L<!-- raw HTML omitted -->0<!-- raw HTML omitted -->⊕f(R<!-- raw HTML omitted -->0<!-- raw HTML omitted -->, K<!-- raw HTML omitted -->1<!-- raw HTML omitted -->)，32位的结果作为第二次加密迭代的R<!-- raw HTML omitted -->1<!-- raw HTML omitted -->，以R<!-- raw HTML omitted -->0<!-- raw HTML omitted -->作为第二次加密迭代的L<!-- raw HTML omitted -->1<!-- raw HTML omitted -->。</li>
<li>第二次加密迭代至第十六次加密迭代分别用子密钥K<!-- raw HTML omitted -->2<!-- raw HTML omitted --> ,&hellip;, K<!-- raw HTML omitted -->16<!-- raw HTML omitted -->进行，其过程与第一次加密迭代相同。</li>
<li>第十六次加密迭代结束后，产生一个64位的数据组，以其左边32位作为R<!-- raw HTML omitted -->16<!-- raw HTML omitted -->， 以其右边32位作为L<!-- raw HTML omitted -->16<!-- raw HTML omitted --> 。</li>
<li>R<!-- raw HTML omitted -->16<!-- raw HTML omitted -->与L<!-- raw HTML omitted -->16<!-- raw HTML omitted -->合并，再经过逆初始置换IP， 将数据重新排列，便得到64位密文。</li>
</ul>
<p>
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/desMain.png">
            <img class="mx-auto" alt="img" src="https://raw.githubusercontent.com/cszxyang/cipher4j/master/imgs/des/desMain.png" />
        </a>
    </p>
<p>整体的加密过程主要函数的代码实现如下</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic"> * 对外的加密接口，主要逻辑封装在encode方法中
</span><span style="color:#998;font-style:italic"> * @param plaintext 明文
</span><span style="color:#998;font-style:italic"> * @param key 密钥
</span><span style="color:#998;font-style:italic"> * @return encrypted text
</span><span style="color:#998;font-style:italic"> * @throws UnsupportedEncodingException caused by String.getBytes()
</span><span style="color:#998;font-style:italic"> */</span>
<span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">encrypt</span><span style="color:#000;font-weight:bold">(</span>String plaintext<span style="color:#000;font-weight:bold">,</span> String key<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> UnsupportedEncodingException <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#998;font-style:italic">// 获取明文及密钥对应的比特串，用字符数组存储
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> plaintextBytes <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">bytesToChars</span><span style="color:#000;font-weight:bold">(</span>
        plaintext<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBytes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;UTF-8&#34;</span><span style="color:#000;font-weight:bold">));</span>
    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> keyBytes <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">bytesToChars</span><span style="color:#000;font-weight:bold">(</span>
        key<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBytes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;UTF-8&#34;</span><span style="color:#000;font-weight:bold">));</span>
	<span style="color:#998;font-style:italic">// 子密钥的生成
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[][]</span> subKeys <span style="color:#000;font-weight:bold">=</span> generateSubKeys<span style="color:#000;font-weight:bold">(</span>keyBytes<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> result <span style="color:#000;font-weight:bold">=</span> encode<span style="color:#000;font-weight:bold">(</span>plaintextBytes<span style="color:#000;font-weight:bold">,</span> subKeys<span style="color:#000;font-weight:bold">);</span>
	<span style="color:#998;font-style:italic">// 使用Base64编码对不可见及非打印字符进行编码
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">return</span> Base64Util<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">encode</span><span style="color:#000;font-weight:bold">(</span>result<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic"> * 主体加密逻辑
</span><span style="color:#998;font-style:italic"> * @param plaintextBytes 用字符数组存放的明文的比特串
</span><span style="color:#998;font-style:italic"> * @param subKeys 子密钥数组
</span><span style="color:#998;font-style:italic"> * @return encryption 64位加密结果
</span><span style="color:#998;font-style:italic"> */</span>
<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> <span style="color:#900;font-weight:bold">encode</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> plaintextBytes<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[][]</span> subKeys<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#998;font-style:italic">// 初始置换 IP
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> chars <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">disruptArray</span><span style="color:#000;font-weight:bold">(</span>plaintextBytes<span style="color:#000;font-weight:bold">,</span> DESConstants<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">IP</span><span style="color:#000;font-weight:bold">);</span>

    <span style="color:#998;font-style:italic">// 将明文分成两半
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">int</span> length <span style="color:#000;font-weight:bold">=</span> chars<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span><span style="color:#000;font-weight:bold">;</span>
    String binaryArrayStr <span style="color:#000;font-weight:bold">=</span> String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">valueOf</span><span style="color:#000;font-weight:bold">(</span>chars<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> left <span style="color:#000;font-weight:bold">=</span> binaryArrayStr<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">substring</span><span style="color:#000;font-weight:bold">(</span>0<span style="color:#000;font-weight:bold">,</span> length <span style="color:#000;font-weight:bold">/</span> 2<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">toCharArray</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> right <span style="color:#000;font-weight:bold">=</span> binaryArrayStr<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">substring</span><span style="color:#000;font-weight:bold">(</span>length <span style="color:#000;font-weight:bold">/</span> 2<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">toCharArray</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> coreEncrypted<span style="color:#000;font-weight:bold">,</span> xorResult<span style="color:#000;font-weight:bold">;</span>

    <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> 16<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#998;font-style:italic">// 调用核心加密函数，用子密钥Ki对R(i-1)进行加密，得到28位数据
</span><span style="color:#998;font-style:italic"></span>        coreEncrypted <span style="color:#000;font-weight:bold">=</span> coreEncrypt<span style="color:#000;font-weight:bold">(</span>right<span style="color:#000;font-weight:bold">,</span> subKeys<span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">]);</span>

        <span style="color:#998;font-style:italic">// L(i - 1)与f(R(i - 1), Ki)进行异或运算
</span><span style="color:#998;font-style:italic"></span>        xorResult <span style="color:#000;font-weight:bold">=</span> String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">valueOf</span><span style="color:#000;font-weight:bold">(</span>ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">xor</span><span style="color:#000;font-weight:bold">(</span>left<span style="color:#000;font-weight:bold">,</span> coreEncrypted<span style="color:#000;font-weight:bold">))</span>
            <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">substring</span><span style="color:#000;font-weight:bold">(</span>16<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">toCharArray</span><span style="color:#000;font-weight:bold">();</span>

        left <span style="color:#000;font-weight:bold">=</span> right<span style="color:#000;font-weight:bold">;</span>
        right <span style="color:#000;font-weight:bold">=</span> xorResult<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> calResult <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">concat</span><span style="color:#000;font-weight:bold">(</span>right<span style="color:#000;font-weight:bold">,</span> left<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#998;font-style:italic">// 逆初始置换
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">return</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">disruptArray</span><span style="color:#000;font-weight:bold">(</span>calResult<span style="color:#000;font-weight:bold">,</span> DESConstants<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">inverseIP</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="二-解密过程">二. 解密过程</h2>
<p>通过数学推理可证明DES具有可逆性和对合性的（限于蝙蝠，在此不作证明），即加密和解密可共用同一个运算，只是子密钥的使用顺序调转而已，即第一次解密迭代使用子密钥K<!-- raw HTML omitted -->16<!-- raw HTML omitted -->，第十六次解密迭代使用子密钥K<!-- raw HTML omitted -->1<!-- raw HTML omitted -->。</p>
<h3 id="代码实现">代码实现</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic"> * 解密
</span><span style="color:#998;font-style:italic"> * @param encryptedText 加密数据
</span><span style="color:#998;font-style:italic"> * @param key  密钥
</span><span style="color:#998;font-style:italic"> * @return decrypted origin plaintext
</span><span style="color:#998;font-style:italic"> * @throws UnsupportedEncodingException caused by String.getBytes()
</span><span style="color:#998;font-style:italic"> */</span>
<span style="color:#3c5d5d;font-weight:bold">@Override</span>
<span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">decrypt</span><span style="color:#000;font-weight:bold">(</span>String encryptedText<span style="color:#000;font-weight:bold">,</span> String key<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> UnsupportedEncodingException <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#998;font-style:italic">// 将已使用Base64编码的密文解码
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> encryptedTextBytes <span style="color:#000;font-weight:bold">=</span> Base64Util<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">decode</span><span style="color:#000;font-weight:bold">(</span>encryptedText<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> keyBytes <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">bytesToChars</span><span style="color:#000;font-weight:bold">(</span>
        key<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBytes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;UTF-8&#34;</span><span style="color:#000;font-weight:bold">));</span>
	
    <span style="color:#998;font-style:italic">// 将通过密钥获取到的子密钥数组逆转
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[][]</span> inverseKeys <span style="color:#000;font-weight:bold">=</span> inverseSubKeys<span style="color:#000;font-weight:bold">(</span>generateSubKeys<span style="color:#000;font-weight:bold">(</span>keyBytes<span style="color:#000;font-weight:bold">));</span>
    <span style="color:#998;font-style:italic">// 解密
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> result <span style="color:#000;font-weight:bold">=</span> encode<span style="color:#000;font-weight:bold">(</span>encryptedTextBytes<span style="color:#000;font-weight:bold">,</span> inverseKeys<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#998;font-style:italic">// 将比特串还原为字符串明文
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">return</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">segmentAndPrintChars</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;decrypt plaintext text&#34;</span><span style="color:#000;font-weight:bold">,</span> result<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic"> * 将通过密钥获取到的子密钥数组逆转
</span><span style="color:#998;font-style:italic"> * @param subKeys 原子密钥数组
</span><span style="color:#998;font-style:italic"> * @return  翻转的子密钥数组
</span><span style="color:#998;font-style:italic"> */</span> 
<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[][]</span> <span style="color:#900;font-weight:bold">inverseSubKeys</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[][]</span> subKeys<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[][]</span> inverseKeys <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[</span>subKeys<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span><span style="color:#000;font-weight:bold">][];</span>

    <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> subKeys<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span><span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
        inverseKeys<span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">=</span> subKeys<span style="color:#000;font-weight:bold">[</span>subKeys<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span> <span style="color:#000;font-weight:bold">-</span> 1 <span style="color:#000;font-weight:bold">-</span> i<span style="color:#000;font-weight:bold">];</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">return</span> inverseKeys<span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="三--测试">三.  测试</h2>
<p>使用Junit进行单元测试，测试结果的输出较长，为不影响阅读请见<a href="https://github.com/jordonyang/cipher4j">Github仓库</a></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#3c5d5d;font-weight:bold">@Test</span>
<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testService</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    String plaintext <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;01234567&#34;</span><span style="color:#000;font-weight:bold">,</span> key <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;12345678&#34;</span><span style="color:#000;font-weight:bold">;</span>
    CipherService cipherService <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> DESCipherService<span style="color:#000;font-weight:bold">();</span>
    <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
        String encryptedText <span style="color:#000;font-weight:bold">=</span> cipherService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">encrypt</span><span style="color:#000;font-weight:bold">(</span>plaintext<span style="color:#000;font-weight:bold">,</span> key<span style="color:#000;font-weight:bold">);</span>
        cipherService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">decrypt</span><span style="color:#000;font-weight:bold">(</span>encryptedText<span style="color:#000;font-weight:bold">,</span>key<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>UnsupportedEncodingException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="四--填充方式工作模式及图形化界面的实现">四.  填充方式、工作模式及图形化界面的实现</h2>
<h3 id="1-填充方式">1. 填充方式</h3>
<p>实现最简单的末字节计数器填充方式，即最后一个分组的最后一个字节用来记录填充的位数，解密后读取该字节并去掉相应长度的数据</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic"> * 明文填充，最后一组的最后8位表示填充长度
</span><span style="color:#998;font-style:italic"> */</span>
<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[][]</span> <span style="color:#900;font-weight:bold">padPlaintext</span><span style="color:#000;font-weight:bold">(</span>String plaintext<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> plaintextBytes <span style="color:#000;font-weight:bold">=</span> ArrayUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">bytesToChars</span><span style="color:#000;font-weight:bold">(</span>
        plaintext<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBytes</span><span style="color:#000;font-weight:bold">());</span>
    <span style="color:#458;font-weight:bold">int</span> length <span style="color:#000;font-weight:bold">=</span> plaintextBytes<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#458;font-weight:bold">int</span> lastBlockBits <span style="color:#000;font-weight:bold">=</span> length <span style="color:#000;font-weight:bold">%</span> 64<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#998;font-style:italic">// 现有块数
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">int</span> blockCount <span style="color:#000;font-weight:bold">=</span> length <span style="color:#000;font-weight:bold">/</span> 64<span style="color:#000;font-weight:bold">;</span>

    <span style="color:#998;font-style:italic">// 待伪随机填充位数
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">int</span> randPadCount <span style="color:#000;font-weight:bold">=</span> 64 <span style="color:#000;font-weight:bold">-</span> lastBlockBits <span style="color:#000;font-weight:bold">-</span> 8<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> padded <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[(</span>blockCount <span style="color:#000;font-weight:bold">+</span> 1<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">*</span> 64<span style="color:#000;font-weight:bold">];</span>
    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arraycopy</span><span style="color:#000;font-weight:bold">(</span>plaintextBytes<span style="color:#000;font-weight:bold">,</span> 0<span style="color:#000;font-weight:bold">,</span> padded<span style="color:#000;font-weight:bold">,</span> 0<span style="color:#000;font-weight:bold">,</span> length<span style="color:#000;font-weight:bold">);</span>

    <span style="color:#998;font-style:italic">// 伪随机填充
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> length<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> padded<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span> <span style="color:#000;font-weight:bold">-</span> 8<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
        padded<span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Random<span style="color:#000;font-weight:bold">().</span><span style="color:#008080">nextBoolean</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">?</span> <span style="color:#d14">&#39;1&#39;</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;0&#39;</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#998;font-style:italic">// 填充最后一个字节比特串
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[]</span> padCountVal <span style="color:#000;font-weight:bold">=</span> Integer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toBinaryString</span><span style="color:#000;font-weight:bold">(</span>
        <span style="color:#000;font-weight:bold">(</span>randPadCount <span style="color:#000;font-weight:bold">&amp;</span> 0xff<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">+</span> 0x0100<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">substring</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">toCharArray</span><span style="color:#000;font-weight:bold">();</span>
    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arraycopy</span><span style="color:#000;font-weight:bold">(</span>padCountVal<span style="color:#000;font-weight:bold">,</span> 0<span style="color:#000;font-weight:bold">,</span> padded<span style="color:#000;font-weight:bold">,</span> padded<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span> <span style="color:#000;font-weight:bold">-</span> 8<span style="color:#000;font-weight:bold">,</span> 8<span style="color:#000;font-weight:bold">);</span>

    <span style="color:#998;font-style:italic">// 将填充完比特穿分组
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[][]</span> blocks <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[</span>blockCount <span style="color:#000;font-weight:bold">+</span> 1<span style="color:#000;font-weight:bold">][</span>64<span style="color:#000;font-weight:bold">];</span>
    <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> blockCount <span style="color:#000;font-weight:bold">+</span> 1<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arraycopy</span><span style="color:#000;font-weight:bold">(</span>padded<span style="color:#000;font-weight:bold">,</span> i <span style="color:#000;font-weight:bold">*</span> 64<span style="color:#000;font-weight:bold">,</span> blocks<span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">],</span> 0<span style="color:#000;font-weight:bold">,</span> 64<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">return</span> blocks<span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="-1--单元测试">( 1 ). 单元测试</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#3c5d5d;font-weight:bold">@Test</span>
<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testPadPlaintext</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    DESCipherService desCipherService <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> DESCipherService<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">);</span>
    desCipherService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">padPlaintext</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;password1&#34;</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="-2--测试结果">( 2 ). 测试结果</h4>
<pre><code>明文：password1
填充前的比特串： 011100000110000101110011011100110111011101101111011100100110010000110001
填充后的比特串： 01110000011000010111001101110011011101110110111101110010011001000011000100101000001000010111101000100111101110010010110100110000
</code></pre><h3 id="2-工作方式">2. 工作方式</h3>
<p>实现<code>ECB</code>、<code>CBC</code>、<code>CTR</code>三种工作模式，为了实现这些，需要将上述的加解密主逻辑代码进行部分调整，调整后的代码可以见<a href="https://github.com/jordonyang/cipher4j/blob/master/src/main/java/org/jordon/security/core/crypto/symmetry/DESCipherService.java">DESCipherService.java</a></p>
<h3 id="3-gui图形界面">3. GUI图形界面</h3>
<p>将加密文件和加密字符串的代码进行分离，使用JFrame进行实现GUI界面，详细代码见<a href="https://github.com/jordonyang/cipher4j/blob/master/src/main/java/org/jordon/security/view/DESView.java">DESView.java</a></p>
<p>(1). 加密明文串效果</p>
<p>
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/jordonyang/jordonyang.github.io/master/images/sec/des//desView5.png">
            <img class="mx-auto" alt="img" src="https://raw.githubusercontent.com/jordonyang/jordonyang.github.io/master/images/sec/des//desView5.png" />
        </a>
    </p>
<p>(2). 加密文件效果</p>
<p>
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/jordonyang/jordonyang.github.io/master/images/sec/des//desView4.png">
            <img class="mx-auto" alt="img" src="https://raw.githubusercontent.com/jordonyang/jordonyang.github.io/master/images/sec/des//desView4.png" />
        </a>
    </p>
<h2 id="五-参考">五. 参考</h2>
<ul>
<li>
<p>《密码学引论》（第三版，张焕国、唐明编著，武汉大学出版社）</p>
</li>
<li>
<p><a href="http://geekeye.cc/post/security/crypto/symmetry/working-mode/">http://geekeye.cc/post/security/crypto/symmetry/working-mode/</a>)</p>
</li>
</ul>
        </div>

        


        


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/%E6%8A%80%E6%9C%AF'>技术</a></li>
                
                <li><a href='/tags/java'>Java</a></li>
                
                <li><a href='/tags/%E5%AF%86%E7%A0%81%E5%AD%A6'>密码学</a></li>
                
                <li><a href='/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8'>信息安全</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2025 <a href="http://cszxyang.cn/">cszxyang By </a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/cszxyang" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">cszxyang</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-C5B6KW9SZQ', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                
            </div>
        </div>
    </div>
</body>

</html>